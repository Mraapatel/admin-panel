import{a as x}from"./chunk-FZIL55DI.js";import{a as H}from"./chunk-FBFTIUTA.js";import{a as q}from"./chunk-6YYPK5MK.js";import{b as G,g as z,h as D,j as Z,m as Y,n as K,o as R,p as B,q as W,s as Q,u as $}from"./chunk-HEVKUVIP.js";import{h as U,j}from"./chunk-DF4QYGB4.js";import{Ab as C,Db as y,Fb as h,Kb as S,Mb as E,Nb as I,Ob as L,Pb as T,Qb as g,Rb as k,Sb as V,Ta as m,Yb as N,ca as f,ha as F,hb as w,mb as _,pa as p,qa as u,qb as b,sb as O,tb as v,ub as M,vb as c,wb as l,xb as P}from"./chunk-5BOCFAQI.js";var X=["inputTag"],tt=(n,a)=>a.countryName;function et(n,a){if(n&1&&(c(0,"option",5),g(1),l()),n&2){let r=a.$implicit;S("value","",r.countryCode2,"+",r._id,""),m(),k(r.country)}}function ot(n,a){if(n&1){let r=C();c(0,"button",16),y("click",function(){let t=p(r).$implicit,i=h();return u(i.cityChoosed(t))}),g(1),l()}if(n&2){let r=a.$implicit;m(),V(" ",r.formatted_address," ")}}function it(n,a){if(n&1){let r=C();c(0,"button",17),y("click",function(){p(r);let t=h();return u(t.storeDrawnArea())}),g(1,"Store Area"),l()}if(n&2){let r=h();_("disabled",!r.storeArea)}}function nt(n,a){if(n&1){let r=C();c(0,"button",19),y("click",function(){p(r);let t=h(2);return u(t.saveChangedArea())}),g(1,"Save changes"),l()}if(n&2){let r=h(2);_("disabled",r.editablezone)}}function rt(n,a){if(n&1&&w(0,nt,2,1,"button",18),n&2){let r=h();b(0,r.editablezone?-1:0)}}var ft=(()=>{let a=class a{constructor(){this._addCountryService=f(q),this._cityService=f(H),this._toastr=f(U),this._fb=f(Q),this.API_KEY=j.API_KEY,this.calledOnce=!0,this.editableCountry=!0,this.editablezone=!0,this.storeArea=!1}ngOnInit(){this.pageload(),this._addCountryService.getCountry().subscribe(e=>{Array.isArray(e)&&(this.countryList=e),console.log(this.countryList)}),this.countryForm=this._fb.group({country:[""],city:[""]}),this.countryForm.get("city")?.disable()}initAutocomplete(){let e=document.getElementById("city");this.autocomplete=new google.maps.places.Autocomplete(e,{types:["(cities)"]}),this.autocomplete.addListener("place_changed",()=>{if(this.storeArea=!1,console.log("hheeeeeeeeeeee"),this.countryForm.get("city")?.value===""){this._toastr.warning("Please enter all the details","Warning");return}e.value.trim()==""&&this.countryForm.get("country")?.disable(),(this.place||this.polygon||this.drawingManager)&&(this.polygon?.setMap(null),this.drawingManager&&this.drawingManager.setMap(null),this.place=null),this.place=this.autocomplete.getPlace(),console.log(this.place),console.log(this.place?.formatted_address);let t=this.cityList.findIndex(i=>i.formatted_address===this.place?.formatted_address);if(t>-1&&(this.cityChoosed(this.cityList[t]),console.log("what")),this.place.geometry&&this.place.geometry.location){this.calledOnce;let i=this.place.geometry?.location,o=i?.lat(),s=i?.lng(),d=new google.maps.LatLng(o,s);this.map.setCenter(d),this.map.setZoom(9)}this.drawingFunction()})}seletedC(e){this.storeArea=!1,this.countryForm.get("city")?.enable();let t=e.split("+"),i=t[0];this.drawinPolygon&&this.drawinPolygon.setMap(null),this.countryForm.get("city")&&this.countryForm.get("city")?.setValue(null),this.polygon&&(this.polygon.setMap(null),this.polygon=null),this.countryId&&(this.countryId=null),this.countryId=t[1],console.log(this.countryId),this._cityService.getCities(this.countryId).subscribe(o=>{this.cityList=o,console.log(this.cityList),console.log(this.countryId)}),this.selectedCountry=i,console.log(i),this.autocomplete&&this.autocomplete.setComponentRestrictions({country:this.selectedCountry})}pageload(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};new x({apiKey:this.API_KEY,libraries:["places","drawing"]}).load().then(()=>{let o=document.getElementById("map");o&&(this.map=new google.maps.Map(o,{center:t,zoom:10,styles:[]}),this.initAutocomplete(),this.geocoder=new google.maps.Geocoder)}).catch(o=>{console.error("Error loading Google Maps API:",o)})},e=>{console.warn("Error getting user location:",e),this.loadDefaultMap()}):(console.error("Geolocation is not supported by this browser."),this.loadDefaultMap())}loadDefaultMap(){new x({apiKey:this.API_KEY,libraries:["places","drawing"]}).load().then(()=>{let t=document.getElementById("map");t&&(this.map=new google.maps.Map(t,{center:{lat:25.4484,lng:78.5685},zoom:6}),this.initAutocomplete(),this.geocoder=new google.maps.Geocoder)}).catch(t=>{console.error("Error loading Google Maps API:",t)})}drawingFunction(){this.drawingManager&&this.drawingManager.setMap(null),this.calledOnce=!1;let e;if(function(t){t.MARKER="marker",t.POLYGON="polygon"}(e||(e={})),this.inputTag.nativeElement.value===""){this._toastr.warning("Please enter all the details","Warning"),this.drawingManager.setMap(null);return}this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,map:this.map,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[e.POLYGON]},polygonOptions:{editable:!0,strokeColor:"#6b0384",strokeOpacity:1,strokeWeight:2,fillColor:"#a66eee",fillOpacity:.35}}),this.drawingManager.setMap(this.map),google.maps.event.addListener(this.drawingManager,"drawingmode_changed",()=>{this.drawingManager.getDrawingMode()!==null?this.map.setOptions({draggable:!1}):this.map.setOptions({draggable:!0})}),google.maps.event.addListener(this.drawingManager,"overlaycomplete",t=>{if(t.type===google.maps.drawing.OverlayType.POLYGON){let o=t.overlay.getPath().getArray();console.log("path------------>",o),this.coordinates&&(this.coordinates=[[[]]]),this.countryForm.get("country")?.disable(),this.countryForm.get("city")?.disable();let s=[o[0].lng(),o[0].lat()];this.coordinates=[[o.map(d=>[d.lng(),d.lat()])]],this.coordinates[0][0].push(s),console.log("Polygon coordinates:",this.coordinates),this.drawinPolygon&&this.drawinPolygon.setMap(null),this.drawinPolygon=t.overlay,this.storeArea=!0,this.map.setOptions({draggable:!0})}})}storeDrawnArea(){if(this.countryForm.get("city")?.value==""){this._toastr.warning("Please enter all the details","Warning");return}let e={countryId:this.countryId,cityName:this.place?.formatted_address,place_id:this.place?.place_id,coordinates:this.coordinates};console.log("placeInfo",e),this._cityService.saveZone(e).subscribe(t=>{console.log(t),this.countryForm.get("city")?.enable(),this.countryForm.get("country")?.enable(),this.countryForm.get("city")?.reset(),this.cityList.push(t),this._toastr.success("Zone saved successfully","Success"),this.storeArea=!1,this.drawinPolygon&&this.drawinPolygon.setMap(null),this.drawingManager&&this.drawingManager.setMap(null)},t=>{this._toastr.error("The Zone already exists","error"),this.countryForm.get("city")?.enable(),this.countryForm.get("country")?.enable(),this.countryForm.get("city")?.reset(),this.storeArea=!1,this.drawingManager&&this.drawingManager.setMap(null),this.drawinPolygon&&this.drawinPolygon.setMap(null),console.log(t)})}cityChoosed(e){console.log("cityChoosed",e.zone.coordinates[0]);let t=e.zone.coordinates[0].map(s=>({lat:s[1],lng:s[0]}));console.log("updated cor",t),this.selectedCity&&(this.selectedCity=null),this.selectedCity=e,this.polygon&&(this.polygon.setMap(null),this.polygon=null),this.polygon=new google.maps.Polygon({paths:t,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0}),this.polygon.setMap(this.map);let i=new google.maps.LatLng(t[0].lat,t[0].lng);this.map.setCenter(i),this.map.setZoom(10),google.maps.event.addListener(this.polygon.getPath(),"set_at",()=>{this.editablezone=!1,o.call(this)}),google.maps.event.addListener(this.polygon.getPath(),"insert_at",()=>{this.editablezone=!1,o.call(this)}),google.maps.event.addListener(this.polygon.getPath(),"remove_at",()=>{this.editablezone=!1,o.call(this)});function o(){this.updatedPolygonCoordinates=[[]],this.polygon.getPath().getArray().forEach(A=>{let J=[A.lng(),A.lat()];this.updatedPolygonCoordinates[0].push(J)});let s=this.polygon.getPath().getArray(),d=[s[0].lng(),s[0].lat()];this.updatedPolygonCoordinates[0].push(d),console.log("Updated Polygon Coordinates:",this.updatedPolygonCoordinates)}}saveChangedArea(){this.editablezone=!0;let e=this.updatedPolygonCoordinates,t={cityId:this.selectedCity?._id,coordinates:e};console.log("Update Zone details",t),this._cityService.saveChangedZone(t).subscribe(i=>{this._toastr.success("Zone updated successfully","Success");let o=i,s=this.cityList.findIndex(d=>d._id==o._id);s>-1&&(this.cityList[s]=o)},i=>{this._toastr.error("Some Error Occured","Error")})}ClearAll(){this.countryForm.get("city")?.enable(),this.countryForm.get("country")?.enable(),this.countryForm.get("city")?.reset(),this.polygon&&this.polygon?.setMap(null),this.drawingManager&&this.drawingManager.setMap(null),this.drawinPolygon&&this.drawinPolygon.setMap(null),this.storeArea=!1}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=F({type:a,selectors:[["app-city"]],viewQuery:function(t,i){if(t&1&&E(X,5),t&2){let o;I(o=L())&&(i.inputTag=o.first)}},standalone:!0,features:[N],decls:25,vars:2,consts:[["seletedCountry",""],["inputTag",""],[3,"formGroup"],[1,"mt-2"],["name","country","id","country","formControlName","country",1,"mt-2","form-select",3,"change"],[3,"value"],[1,"mt-3"],["for","city",1,"form-label"],["type","text","id","city","name","city","placeholder","enter your city","formControlName","city",1,"form-control"],[1,"row"],["id","map",1,"mx-2","shadow","col","col-xxl-7","col-xl-12","col-lg-12","col-md-12","col-sm-12","col-xs-12","col-12","container","left","rounded"],[1,"overflow-auto","col","col-xxl-5","col-xl-12","col-lg-12","col-md-12","col-sm-12","col-xs-12","col-12","container","right","rounded","shadow"],[1,"text-center","mt-1"],[1,"btn","form-control","btn-info","mt-2","shadow"],[1,"btn","btn-warning","mt-2","me-3",3,"click"],[1,"btn","btn-info","mt-2",3,"disabled"],[1,"btn","form-control","btn-info","mt-2","shadow",3,"click"],[1,"btn","btn-info","mt-2",3,"click","disabled"],[1,"btn","btn-warning","mt-2","ms-3",3,"disabled"],[1,"btn","btn-warning","mt-2","ms-3",3,"click","disabled"]],template:function(t,i){if(t&1){let o=C();c(0,"form",2)(1,"div")(2,"h5",3),g(3,"Select the Country:"),l(),c(4,"select",4,0),y("change",function(){p(o);let d=T(5);return u(i.seletedC(d.value))}),v(6,et,2,4,"option",5,tt),l()(),c(8,"div",6)(9,"label",7),g(10,"city:"),l(),P(11,"input",8,1),l()(),c(13,"div",9),P(14,"div",10),c(15,"div",11)(16,"ul")(17,"h5",12),g(18," Previously Stored Zones"),l(),v(19,ot,2,1,"button",13,O),l()()(),c(21,"button",14),y("click",function(){return p(o),u(i.ClearAll())}),g(22,"Clear"),l(),w(23,it,2,1,"button",15)(24,rt,1,1)}t&2&&(_("formGroup",i.countryForm),m(6),M(i.countryList),m(13),M(i.cityList),m(4),b(23,i.storeArea?23:24))},dependencies:[$,Z,B,W,G,R,z,D,Y,K],styles:[".left[_ngcontent-%COMP%]{margin-top:2vh;height:70vh;float:left}.right[_ngcontent-%COMP%]{margin-top:2vh;height:70vh;width:30vw;float:right}ul[_ngcontent-%COMP%]{list-style:none}.shadow[_ngcontent-%COMP%]{box-shadow:0 .5rem 1rem #00000026}@media screen and (max-width: 1400px){.right[_ngcontent-%COMP%]{width:100vw}}"]});let n=a;return n})();export{ft as CityComponent};
