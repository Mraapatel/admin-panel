import{b}from"./chunk-NBEQBZPI.js";import{b as I,h as v,j as T}from"./chunk-362XMKWF.js";import{A as u,B as m,E as p,V as f,Y as s,ba as g,ca as c,k as h,l as a,o as d,z as r}from"./chunk-5BOCFAQI.js";var S=(()=>{class e{constructor(){this.expired$=new h}startWatching(n){return this.idle$=m(r(document,"mousemove"),r(document,"click"),r(document,"mousedown"),r(document,"keypress"),r(document,"DOMMouseScroll"),r(document,"mousewheel"),r(document,"touchmove"),r(document,"MSPointerMove"),r(window,"mousemove"),r(window,"resize")),this.timeOutMilliSeconds=n*1e3,this.idleSubscription=this.idle$.subscribe(i=>{this.resetTimer()}),this.startTimer(),this.expired$}startTimer(){this.timer$=u(this.timeOutMilliSeconds,this.timeOutMilliSeconds).subscribe(n=>{this.expired$.next(!0)})}resetTimer(n){this.timer$.unsubscribe(),n&&(this.timeOutMilliSeconds=n*1e3),this.startTimer()}stopTimer(){this.timer$.unsubscribe(),this.idleSubscription.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=s({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var A=(()=>{let t=class t{constructor(){this.http=c(I),this.bnIdle=c(S),this.router=c(b),this._tostr=c(v),this.backendUrl=T.BACKEND_URL,this.idleTimeout=20*60*1e3,this.JWT_TOKEN="JWT_TOKEN",this.isAuthenticated=new a(!1),this.isIdle=new a(!1),this.getTokenbs=new a(""),this.checkTokenValidity()}startWatching(){this.bnIdle.startWatching(this.idleTimeout).subscribe(i=>{console.log("session Expired"),this._tostr.warning("Session Expired","Warning"),this._tostr.info("Logged Out","Info"),localStorage.removeItem(this.JWT_TOKEN),this.router.navigate(["login"]),this.isIdle.next(!0),this.stopWatching()})}get IdleState(){return this.isIdle.value}fetchtoken(){return this.getTokenbs.asObservable()}login(i){return this.http.post(`${this.backendUrl}authenticate`,i).pipe(f(o=>{this.doLoginAdmin(i.username,o),this.getTokenbs.next(o.token)}),p(o=>(console.log(o),o.status===401?this._tostr.error(`${o.error.message}`,"Error"):this._tostr.error("Some error occured","Error"),d(o))))}doLoginAdmin(i,o){this.loggedAdmin=i,console.log("helo"),this.storeJwtToken(o.token),this.startWatching(),this.isAuthenticated.next(!0),this.isIdle.next(!1)}storeJwtToken(i){localStorage.setItem(this.JWT_TOKEN,i),localStorage.setItem("notificationCount","1"),sessionStorage.setItem(this.JWT_TOKEN,i)}checkTokenValidity(){localStorage.getItem(this.JWT_TOKEN)&&this.isAuthenticated.next(!0)}logout(){this.router.navigate(["login"]),localStorage.clear(),this.isAuthenticated.next(!1),this.stopWatching(),this.isIdle.next(!0),this._tostr.info("Logged Out","Info")}stopWatching(){this.bnIdle.stopTimer()}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var k=(()=>{let t=class t{constructor(){this.spinnerCounter=!1}startSPinner(){this.spinnerCounter=!0,console.warn("Start value",this.spinnerCounter)}stopSpinner(){this.spinnerCounter=!1,console.warn("stop value",this.spinnerCounter)}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var D=(()=>{let t=class t{constructor(i){this._loaderService=i}startSPinner(){this._loaderService.startSPinner()}stopSpinner(){this._loaderService.stopSpinner()}};t.\u0275fac=function(o){return new(o||t)(g(k))},t.\u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{A as a,k as b,D as c};
