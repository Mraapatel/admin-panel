import{a as ue}from"./chunk-F4ANZG5M.js";import{a as ce}from"./chunk-GDCX6WUU.js";import{a as me}from"./chunk-7LJRBVXL.js";import{b as Y,d as h,g as J,h as ee,j as te,m as ie,n as re,o as ne,p as oe,q as le,s as ae,u as se}from"./chunk-HEVKUVIP.js";import{b as X,h as de,j as P}from"./chunk-CXD4KBSD.js";import{Ab as F,Db as g,E as S,Fb as v,Ib as M,Jb as j,Mb as Q,Nb as W,Ob as G,Pb as L,Qa as O,Qb as o,Rb as D,Sb as K,Ta as d,Tb as A,V as E,Y as R,Yb as z,ca as x,e as V,ha as q,hb as u,ib as B,jb as H,kb as $,mb as b,o as N,ob as U,p as I,pa as p,qa as _,qb as m,sb as T,tb as k,ub as w,vb as l,wb as i,xb as f,xc as Z}from"./chunk-5BOCFAQI.js";var ve=(()=>{let s=class s{constructor(){this.backendUrl=P.BACKEND_URL,this._http=x(X)}storeDriver(e){return console.log(e),this._http.post(`${this.backendUrl}driver/addDriver`,e)}getExistingDrivers(e){return console.log(e),this._http.post(`${this.backendUrl}driver/getDrivers`,e)}updateDriver(e){return this._http.post(`${this.backendUrl}driver/updateDriver`,e)}deleteDriver(e){return this._http.post(`${this.backendUrl}driver/deleteDriver`,{id:e})}addService(e){return this._http.post(`${this.backendUrl}driver/addService`,e)}approveOrDecline(e){return this._http.post(`${this.backendUrl}driver/approve`,e)}getCitiesFormCID(e){return this._http.post(`${this.backendUrl}driver/getCities`,{countryId:e})}storeBankDetails(e){return this._http.post(`${this.backendUrl}driver/storeBankDetails`,e)}};s.\u0275fac=function(n){return new(n||s)},s.\u0275prov=R({token:s,factory:s.\u0275fac,providedIn:"root"});let t=s;return t})();var pe=["inputValue"];function _e(t,s){t&1&&(l(0,"span",7),o(1,"Driver Name is required."),i())}function ge(t,s){t&1&&(l(0,"span",7),o(1,"Driver Name should be "),l(2,"b"),o(3,"6"),i(),o(4," character long."),i())}function fe(t,s){t&1&&(l(0,"span",7),o(1,"character execeded."),i())}function Ce(t,s){if(t&1&&u(0,_e,2,0,"span",7)(1,ge,5,0,"span",7)(2,fe,2,0,"span",7),t&2){let a=v();m(0,a.driverName.errors!=null&&a.driverName.errors.required?0:-1),d(),m(1,a.driverName.errors!=null&&a.driverName.errors.minlength?1:-1),d(),m(2,a.driverName.errors!=null&&a.driverName.errors.maxlength?2:-1)}}function be(t,s){t&1&&(l(0,"span",7),o(1,"Driver Email is required."),i())}function xe(t,s){t&1&&(l(0,"span",7),o(1,"Driver Email should be "),l(2,"b"),o(3,"4"),i(),o(4," character long."),i())}function De(t,s){t&1&&(l(0,"span",7),o(1,"character execeded."),i())}function ye(t,s){if(t&1&&u(0,be,2,0,"span",7)(1,xe,5,0,"span",7)(2,De,2,0,"span",7),t&2){let a=v();m(0,a.driverEmail.errors!=null&&a.driverEmail.errors.required?0:-1),d(),m(1,a.driverEmail.errors!=null&&a.driverEmail.errors.minlength?1:-1),d(),m(2,a.driverEmail.errors!=null&&a.driverEmail.errors.maxlength?2:-1)}}function Se(t,s){t&1&&(l(0,"span",7),o(1,"file is required."),i(),f(2,"br"))}function Ee(t,s){if(t&1&&u(0,Se,3,0),t&2){let a=v();m(0,a.driverProfile.errors!=null&&a.driverProfile.errors.required?0:-1)}}function Ne(t,s){if(t&1&&(l(0,"option",16),o(1),i()),t&2){let a=s.$implicit;M("value",a._id),d(),A(" ",a.countryCallingCode," (",a.country,")")}}function Fe(t,s){t&1&&(f(0,"br"),l(1,"span",7),o(2,"Calling code is required."),i())}function Te(t,s){if(t&1&&u(0,Fe,3,0),t&2){let a=v();m(0,a.countryCallingCode.errors!=null&&a.countryCallingCode.errors.required?0:-1)}}function ke(t,s){t&1&&(l(0,"span",7),o(1,"Phone no. is required."),i())}function we(t,s){t&1&&(f(0,"br"),l(1,"span",7),o(2,"Phone no. should be "),l(3,"b"),o(4,"10"),i(),o(5," character long."),i())}function Le(t,s){t&1&&(f(0,"br"),l(1,"span",7),o(2,"character execeded."),i())}function Pe(t,s){if(t&1&&u(0,ke,2,0,"span",7)(1,we,6,0)(2,Le,3,0),t&2){let a=v();m(0,a.driverPhone.errors!=null&&a.driverPhone.errors.required?0:-1),d(),m(1,a.driverPhone.errors!=null&&a.driverPhone.errors.minlength?1:-1),d(),m(2,a.driverPhone.errors!=null&&a.driverPhone.errors.maxlength?2:-1)}}function Ve(t,s){if(t&1&&(l(0,"option",16),o(1),i()),t&2){let a=s.$implicit;b("value",a._id),d(),D(a.formatted_address)}}function Ae(t,s){t&1&&(l(0,"span",7),o(1,"Driver city is required."),i())}function Ie(t,s){if(t&1&&u(0,Ae,2,0,"span",7),t&2){let a=v();m(0,a.driverCity.errors!=null&&a.driverCity.errors.required?0:-1)}}function Re(t,s){t&1&&(l(0,"button",21),o(1,"Submit"),i())}function qe(t,s){if(t&1){let a=F();l(0,"div",22)(1,"button",67),g("click",function(){p(a);let n=v();return _(n.updateDriver())}),o(2,"update"),i(),l(3,"button",68),g("click",function(){p(a);let n=v();return _(n.clearAll())}),o(4,"Clear"),i()()}}function Oe(t,s){if(t&1&&o(0),t&2){let a=v().$implicit;K(" ",a.serviceType.vehicleType," ")}}function Be(t,s){t&1&&o(0," Add Service ")}function He(t,s){if(t&1){let a=F();l(0,"tr",69)(1,"td"),o(2),i(),l(3,"td"),f(4,"img",70),i(),l(5,"td"),o(6),i(),l(7,"td",71),o(8),i(),l(9,"td",71),o(10),i(),l(11,"td")(12,"button",72),g("click",function(){let n=p(a).$implicit,r=v(2);return _(r.getServices(n))}),u(13,Oe,1,1)(14,Be,1,0),i()(),l(15,"td")(16,"button",73),g("click",function(){let n=p(a).$implicit,r=v(2);return _(r.approveOrDecline(n))}),o(17),i()(),l(18,"td")(19,"button",74),g("click",function(){let n=p(a).$implicit,r=v(2);return _(r.getDriverId(n))}),o(20,"Add Bank Details"),i()(),l(21,"td")(22,"button",75),g("click",function(){let n=p(a).$implicit,r=v(2);return _(r.editClicked(n))}),o(23,"Edit"),i()(),l(24,"td")(25,"button",76),g("click",function(){let n=p(a).$implicit,r=v(2);return _(r.deleteClicked(n._id))}),o(26,"Delete"),i()()(),f(27,"br")}if(t&2){let a=s.$implicit,e=v(2);d(2),D(a.driverName),d(2),j("alt","",a.driverName," Icon"),b("src",e.backendUrl+"public/driverProfile/"+a.driverProfile,O),d(2),A("",a.countryId.countryCallingCode," ",a.driverPhone,""),d(2),D(a.driverEmail),d(2),D(a.cityId==null?null:a.cityId.formatted_address),d(3),m(13,a.serviceType?13:14),d(3),U("btn-success",a.approveStatus)("btn-danger",!a.approveStatus),d(),D(a.approveStatus?"Approved":"Declined")}}function $e(t,s){if(t&1&&k(0,He,28,14,null,null,T),t&2){let a=v();w(a.driverFatched)}}function Ue(t,s){t&1&&(l(0,"span",77),o(1,"Selected"),i())}function Me(t,s){if(t&1){let a=F();l(0,"tr",53)(1,"th",54)(2,"input",55),g("change",function(){let n=p(a).$implicit,r=v(2);return _(r.onServiceSelected(n._id))}),i()(),l(3,"th",56)(4,"label",57),o(5),i(),u(6,Ue,2,0,"span",77),i()(),f(7,"br")}if(t&2){let a=s.$implicit,e=v(2);d(2),b("checked",a._id==(e.selectedDriver.serviceType==null?null:e.selectedDriver.serviceType._id)),d(3),D(a.vehicleType),d(),m(6,a._id===(e.selectedDriver.serviceType==null?null:e.selectedDriver.serviceType._id)?6:-1)}}function je(t,s){if(t&1&&k(0,Me,8,3,null,null,T),t&2){let a=v();w(a.vehicleTypeList)}}function Qe(t,s){t&1&&(l(0,"div",78),o(1,"loading..."),i())}function We(t,s){t&1&&(l(0,"div",79),o(1,"loading..."),i())}function Ge(t,s){t&1&&(l(0,"div",80),o(1,"Some Error Occured"),i())}function Ke(t,s){t&1&&(l(0,"span",58),o(1,"None selected"),i())}function ze(t,s){t&1&&(l(0,"div")(1,"h4",81),o(2,"Bank Account is Added Already"),i()())}function Ze(t,s){t&1&&(l(0,"span",7),o(1,"Account Holder Name is required"),i())}function Xe(t,s){t&1&&(l(0,"span",7),o(1,"Account Holder Name should be "),l(2,"b"),o(3,"4"),i(),o(4," character long"),i())}function Ye(t,s){t&1&&(l(0,"span",7),o(1,"character execeded"),i())}function Je(t,s){if(t&1&&u(0,Ze,2,0,"span",7)(1,Xe,5,0,"span",7)(2,Ye,2,0,"span",7),t&2){let a,e,n,r=v(2);m(0,!((a=r.bankDetailsForm.get("AccountHolderName"))==null||a.errors==null)&&a.errors.required?0:-1),d(),m(1,!((e=r.bankDetailsForm.get("AccountHolderName"))==null||e.errors==null)&&e.errors.minlength?1:-1),d(),m(2,!((n=r.bankDetailsForm.get("AccountHolderName"))==null||n.errors==null)&&n.errors.maxlength?2:-1)}}function et(t,s){t&1&&(l(0,"span",7),o(1,"AccountNumber is required"),i())}function tt(t,s){t&1&&(l(0,"span",7),o(1,"AccountNumber should be "),l(2,"b"),o(3,"8"),i(),o(4," character long"),i())}function it(t,s){t&1&&(l(0,"span",7),o(1,"character execeded"),i())}function rt(t,s){if(t&1&&u(0,et,2,0,"span",7)(1,tt,5,0,"span",7)(2,it,2,0,"span",7),t&2){let a,e,n,r=v(2);m(0,!((a=r.bankDetailsForm.get("AccountNumber"))==null||a.errors==null)&&a.errors.required?0:-1),d(),m(1,!((e=r.bankDetailsForm.get("AccountNumber"))==null||e.errors==null)&&e.errors.minlength?1:-1),d(),m(2,!((n=r.bankDetailsForm.get("AccountNumber"))==null||n.errors==null)&&n.errors.maxlength?2:-1)}}function nt(t,s){t&1&&(l(0,"span",7),o(1,"RoutingNumber is required"),i())}function ot(t,s){t&1&&(l(0,"span",7),o(1,"RoutingNumber should be "),l(2,"b"),o(3,"4"),i(),o(4," character long"),i())}function lt(t,s){t&1&&(l(0,"span",7),o(1,"character execeded"),i())}function at(t,s){if(t&1&&u(0,nt,2,0,"span",7)(1,ot,5,0,"span",7)(2,lt,2,0,"span",7),t&2){let a,e,n,r=v(2);m(0,!((a=r.bankDetailsForm.get("RoutingNumber"))==null||a.errors==null)&&a.errors.required?0:-1),d(),m(1,!((e=r.bankDetailsForm.get("RoutingNumber"))==null||e.errors==null)&&e.errors.minlength?1:-1),d(),m(2,!((n=r.bankDetailsForm.get("RoutingNumber"))==null||n.errors==null)&&n.errors.maxlength?2:-1)}}function st(t,s){if(t&1){let a=F();l(0,"form",82),g("submit",function(){p(a);let n=v();return _(n.storeAccountDetails())}),l(1,"div",5)(2,"label",83),o(3,"Account Holder Name:"),i(),f(4,"input",84),u(5,Je,3,3),i(),l(6,"div",5)(7,"label",85),o(8,"AccountNumber:"),i(),f(9,"input",86),u(10,rt,3,3),i(),l(11,"div",5)(12,"label",87),o(13,"RoutingNumber:"),i(),f(14,"input",88),u(15,at,3,3),i(),l(16,"div",5)(17,"button",89),o(18,"Submit"),i()()()}if(t&2){let a,e,n,r=v();b("formGroup",r.bankDetailsForm),d(5),m(5,((a=r.bankDetailsForm.get("AccountHolderName"))==null?null:a.errors)!==null&&((a=r.bankDetailsForm.get("AccountHolderName"))!=null&&a.touched||(a=r.bankDetailsForm.get("AccountHolderName"))!=null&&a.dirty)?5:-1),d(5),m(10,((e=r.bankDetailsForm.get("AccountNumber"))==null?null:e.errors)!==null&&((e=r.bankDetailsForm.get("AccountNumber"))!=null&&e.touched||(e=r.bankDetailsForm.get("AccountNumber"))!=null&&e.dirty)?10:-1),d(5),m(15,((n=r.bankDetailsForm.get("RoutingNumber"))==null?null:n.errors)!==null&&((n=r.bankDetailsForm.get("RoutingNumber"))!=null&&n.touched||(n=r.bankDetailsForm.get("RoutingNumber"))!=null&&n.dirty)?15:-1)}}var Ft=(()=>{let s=class s{constructor(){this._fb=x(ae),this._addCountryService=x(me),this._driverListService=x(ve),this._tostr=x(de),this._vehicleTypeService=x(ce),this.backendUrl=P.BACKEND_URL,this.driverFatched=[],this.CountryCodes=[],this.formData=new FormData,this.update=!1,this.APPROVE=!1,this.citySelected=!1,this.getCitiesOrNot=!0,this.extensions=["jpg","jpeg","png","gif","bmp","tiff","tif","webp","svg","avif"],this.pageNumber=1,this.sortValue="none",this.searchTerm=null}ngOnInit(){this.driverForm=this._fb.group({driverProfile:[null,h.required],driverName:["",[h.required,h.minLength(6),h.maxLength(30)]],driverEmail:["",[h.required,h.email,h.minLength(4),h.maxLength(64)]],countryId:[""],countryCallingCode:["",h.required],driverCity:["",h.required],driverPhone:["",[h.required,h.minLength(10),h.maxLength(10)]]}),this.bankDetailsForm=this._fb.group({AccountHolderName:["",[h.required,h.minLength(6),h.maxLength(30)]],RoutingNumber:["110000000",[h.required,h.email,h.minLength(4),h.maxLength(64)]],AccountNumber:["000123456789",[h.required,h.minLength(8),h.maxLength(12)]]}),this.getCountryCodes(),this.getDriver(),this.loadStripe()}loadStripe(){return V(this,null,function*(){if(!this.STRIPE)try{this.STRIPE=yield ue("pk_test_51PKFbURvggPBSsNZHM7EzVRAd0C41qQyAhsHDMyp8XxUdjXkZhjsLrkQN0YREobqcQfQOyQmuuIBHO94EHd2TGpc00kWQ3qOBF")}catch(e){console.error("Error loading Stripe SDK:",e)}return this.STRIPE})}storeAccountDetails(){return V(this,null,function*(){if(this.STRIPE){let{token:e,error:n}=yield this.STRIPE.createToken("bank_account",{account_holder_name:this.bankDetailsForm.get("AccountHolderName")?.value,account_holder_type:"individual",account_number:this.bankDetailsForm.get("AccountNumber")?.value,country:"US",currency:"usd",routing_number:this.bankDetailsForm.get("RoutingNumber")?.value});n?console.error("Error creating token:",n):console.log("Token created:",e);let r={driverId:this.selectedDriver._id,token:e.id};console.log(this.bankDetailsForm.get("AccountHolderName")?.value),console.log(this.bankDetailsForm.get("AccountNumber")?.value),console.log(this.bankDetailsForm.get("RoutingNumber")?.value),this._driverListService.storeBankDetails(r).pipe(S(c=>(console.log("Error while storing the bank account",c),this._tostr.error(c.error.message,"Error"),I(c)))).subscribe({complete:()=>{this.bankDetailsForm.reset();let c=this.driverFatched.findIndex(C=>C._id===this.selectedDriver._id);this.driverFatched[c].bankDetailsAdded=!0,this._tostr.success("The Bank Account is Added","Success")}})}else this._tostr.error("Not enable to create token","error")})}getDriverId(e){this.selectedDriver=e}getCountryCodes(){this._addCountryService.getCountry().pipe(E(e=>{console.log(e),this.CountryCodes=e}),S(e=>(this._tostr.error("Enable to fatch country code","Error"),console.log("some error occured"),N(e)))).subscribe()}getDriver(){let e={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(e)}onFileSelected(e){let n=e.target.files?.[0];if(n){let r=n.type.split("/").pop();if(console.log(r),!r||this.extensions.indexOf(r)===-1){this._tostr.warning(`.${r} type is not allowd`,"Warning"),this.driverForm.get("driverProfile")?.reset();return}this.formData.delete("driverProfile"),this.formData.append("driverProfile",n)}}SelectedSortValue(e){if(console.log(e),this.sortValue=e,this.totalDrivers>1){let n={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(n)}}onSubmit(){if(this.driverForm.invalid){this._tostr.error("Please fill the Required/Valid data","Error"),this.driverForm.markAllAsTouched();return}let e=this.driverForm.get("driverName")?.value;if(this.driverForm.get("driverName")?.setValue(e.trim()),!this.validateEmail()||!this.validatePhone())return;this.formData.append("driverName",this.driverForm.get("driverName")?.value.trim()),this.formData.append("driverEmail",this.driverForm.get("driverEmail")?.value.trim()),this.formData.append("driverPhone",this.driverForm.get("driverPhone")?.value);let n=this.driverForm.get("countryCallingCode")?.value;console.log(n);let r=this.CountryCodes.findIndex(c=>c._id===n);if(console.log("counrtyr id ---",this.CountryCodes[r]._id),this.formData.append("countryId",this.driverForm.get("countryCallingCode")?.value),r>-1)this.selectedCountryC=this.CountryCodes[r];else{this._tostr.error("Sorry some Error Occured form ourside","Error"),this._tostr.info("Please refresh the page and retry","Info");return}console.log("yooooooooooo"),console.log(this.driverForm.value),this._driverListService.storeDriver(this.formData).pipe(E(c=>{if(console.log(c),this.driverFatched.length>0)if(this.driverFatched.length<=1)this.driverFatched.push(c);else{let C={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(C)}this._tostr.success("Driver Added Successfully","Success"),this.driverForm.reset(),this.formData=new FormData}),S(c=>(c.status===400?c.error.error==="Email already exists!"?this._tostr.warning("Email already exists","Warning"):c.error.error==="Phone number already exists!"?this._tostr.warning("Phone number already exists","Warning"):console.log("Unknown validation error:",c.error.error):(console.log("Unexpected error:",c),this._tostr.error("Some error Occured","Error")),this.clearFormData(),N(c)))).subscribe()}getTheCities(){let e=this.driverForm.get("countryCallingCode")?.value;console.log(e);let n=this.CountryCodes.findIndex(r=>r._id===`${e}`);n>-1&&(this.selectedCountryC=this.CountryCodes[n],console.log(this.selectedCountryC)),console.log(this.selectedCountryC._id),this.getCities(this.selectedCountryC._id)}editClicked(e){this.getCitiesOrNot=!0,this.driverForm.reset(),this.driverForm.get("driverProfile")?.clearValidators(),this.driverForm.get("driverProfile")?.updateValueAndValidity(),this.selectedDriver=e,console.log(this.selectedDriver),this.getCitiesOrNot&&this.getCities(this.selectedDriver.countryId._id),this.getCitiesOrNot=!1,this.update=!0,this.driverForm.get("countryCallingCode")?.disable(),this.driverForm.patchValue({driverName:e.driverName,driverPhone:e.driverPhone,driverEmail:e.driverEmail,countryCallingCode:this.selectedDriver.countryId._id,driverCity:e.cityId?._id}),console.log(this.selectedDriver.cityId?._id),console.log(e.cityId?._id),this.formData.delete("driverCity");let n=this.selectedDriver.cityId?._id.trim();this.formData.append("driverCity",n)}getCities(e){this._driverListService.getCitiesFormCID(e).subscribe(n=>{this.cityList=n,console.log(this.cityList)})}selectedCity(){this.formData.delete("driverCity"),console.log(this.driverForm.get("driverCity")?.value),this.formData.append("driverCity",this.driverForm.get("driverCity")?.value.trim()),this.citySelected=!0}clearFormData(){this.formData.delete("driverName"),this.formData.delete("driverEmail"),this.formData.delete("countryId"),this.formData.delete("driverPhone"),this.formData.delete("driverCity"),this.formData.delete("id"),this.getCitiesOrNot=!0}updateDriver(){if(this.driverForm.invalid){this._tostr.error("Please fill the Required/Valid data","Error"),this.driverForm.markAllAsTouched();return}if(this.driverForm.get("driverName")?.value.trim()===""||this.driverForm.get("driverEmail")?.value.trim()===""||this.driverForm.get("driverPhone")?.value.trim()===""){let e=this.driverForm.get("driverName")?.value;this.driverForm.get("driverName")?.setValue(e.trim()),this._tostr.error("Please fill in all required fields.","Error");return}!this.validateEmail()||!this.validatePhone()||(console.log(this.selectedDriver),this.clearFormData(),this.formData.append("driverName",this.driverForm.get("driverName")?.value.trim()),this.formData.append("driverEmail",this.driverForm.get("driverEmail")?.value.trim()),this.formData.append("countryId",this.selectedDriver.countryId._id),this.formData.append("driverPhone",this.driverForm.get("driverPhone")?.value),this.formData.append("driverCity",this.driverForm.get("driverCity")?.value),this.formData.append("id",this.selectedDriver._id),console.log(this.selectedDriver),this._driverListService.updateDriver(this.formData).pipe(E(e=>{console.log(e);let n=this.driverFatched.findIndex(r=>r._id===e._id);this.driverFatched[n]=e,console.log(this.driverFatched[n]),this._tostr.success("Driver Updated Successfully","Success"),this.update=!1,this.driverForm.reset(),this.formData=new FormData,this.driverForm.get("countryCallingCode")?.enable(),this.driverForm.get("driverProfile")?.setValidators([h.required]),this.driverForm.get("driverProfile")?.updateValueAndValidity(),this.getCitiesOrNot=!0,this.cityList=[]}),S(e=>(console.log(e),e.status===400?e.error.error==="Email already exists!"?(this._tostr.warning("Email already exists","Warning"),this.clearFormData()):e.error.error==="Phone number already exists!"?(this._tostr.warning("Phone number already exists","Warning"),this.clearFormData()):(console.log("Unknown validation error:",e.error.error),this.clearFormData()):(console.log("Unexpected error:",e),this.clearFormData()),N(e)))).subscribe())}deleteClicked(e){console.log(e),confirm("Do you really want to delete driver")&&this._driverListService.deleteDriver(e).subscribe(r=>{console.log(r),this.driverForm.reset(),this.driverFatched.length===1&&(this.driverFatched=[],this.pageNumber--);let c={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(c),this._tostr.warning("Driver deleted successfully","Success")})}clearAll(){this.formData=new FormData,this.driverForm.reset(),this.driverForm.get("countryCallingCode")?.enable(),this.update=!this.update}previousBtn(){if(this.disablePrevBnt()){this._tostr.warning("Can't perform this action ","Warning");return}this.pageNumber=this.pageNumber>1?--this.pageNumber:1,console.log(this.pageNumber);let e={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(e)}nextBtn(){if(this.disableNextBnt()){this._tostr.warning("Can't perform this action ","Warning");return}this.pageNumber=++this.pageNumber,console.log(this.pageNumber);let e={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(e)}get driverProfile(){return this.driverForm.get("driverProfile")}get driverName(){return this.driverForm.get("driverName")}get driverEmail(){return this.driverForm.get("driverEmail")}get countryCallingCode(){return this.driverForm.get("countryCode")}get driverPhone(){return this.driverForm.get("driverPhone")}get driverCity(){return this.driverForm.get("driverCity")}fatchDriver(e){this._driverListService.getExistingDrivers(e).subscribe(n=>{console.log(n),this.driverFatched=n.Drivers,this.totalDrivers=n.totalDrivers,this.driverFatched&&(this.driverFatched.length>-1?this.driverFatchedlength=this.driverFatched.length:this.driverFatchedlength=-1)},n=>{console.log("borrrrrrrrrrrrrrr",n),this._tostr.info("Showing main tabel  ","info"),this._tostr.error("No Driver Found","Error"),console.log(n.error.Message),this.searchTag.nativeElement.value="",this.searchTerm="",this.pageNumber=1,this.disablePrevBnt(),console.log(n.error.Message),this.disableNextBnt()})}getServices(e){console.log(this.selectedDriver),this.servicePresent=null,this.servicePresent=!!e.serviceType,this.selectedDriver=e,this.vehicleTypeList=[],console.log(this.selectedDriver),console.log("getServices"),this._vehicleTypeService.getAllServices(this.selectedDriver.countryId._id,this.selectedDriver.cityId._id).pipe(E(n=>{console.log(n),this.vehicleTypeList=n,console.log(this.vehicleTypeList)})).subscribe()}onServiceSelected(e){console.log(e);let n={driverId:this.selectedDriver._id,serviceId:e};this.addRemoveService(n)}onServiceNullSelected(e){console.log("inside onServiceNullSelected");let n={driverId:this.selectedDriver._id,serviceId:null};this.addRemoveService(n)}addRemoveService(e){console.log(this.selectedDriver),this._driverListService.addService(e).pipe(E(n=>{if(n.Message==="Service Added Successfully"){this.selectedDriver.serviceType=n.Driver.serviceType,this.servicePresent=!0;let r=this.driverFatched.findIndex(c=>c._id==n.Driver._id);console.log(n),console.log(this.driverFatched[r]),this.driverFatched[r].serviceType=n.Driver.serviceType,this._tostr.success("Service added","Success")}else{this.selectedDriver.serviceType=n.Driver.serviceType,this.servicePresent=!1;let r=this.driverFatched.findIndex(c=>c._id==n.Driver._id);console.log(n),this.driverFatched[r].serviceType=n.Driver.serviceType,this._tostr.warning("Service removed","Warning"),this.selectedDriver.serviceType=null}}),S(n=>(console.log(n),this._tostr.error("Some  Occured","Error"),N(n)))).subscribe()}searchDriver(e){if(e==""){this._tostr.warning("Please Enter Some Values","Warning"),this._tostr.info("Showing main tabel  ","info"),this.searchTerm="";return}this.pageNumber=1,console.log(e),this.searchTerm=e,this.sortValue="none";let n={page:this.pageNumber,sort:this.sortValue,searchTerm:this.searchTerm};this.fatchDriver(n)}approveOrDecline(e){let n={driverId:e._id,approveStatus:!e.approveStatus};this._driverListService.approveOrDecline(n).pipe(E(r=>{console.log(r);let c=this.driverFatched.findIndex(C=>C._id===r.Driver._id);this.driverFatched[c].approveStatus=r.Driver.approveStatus,this._tostr.success("Status Changed","Success")}),S(r=>(console.log(r),this._tostr.error("Error Occured while updating","Error"),N(r)))).subscribe()}disablePrevBnt(){return this.pageNumber==1?!0:this.pageNumber==0}disableNextBnt(){if(this.totalDrivers==this.pageNumber*2)return!0;if(this.totalDrivers<this.pageNumber*2)return!0;if(this.driverFatched){if(this.driverFatched.length<0)return!0}else if(this.pageNumber==0)return!0;return!1}validateEmail(){let e=/^[\w-]+(?:\.[\w-]+)*@(?:[\w-]+\.)+[a-zA-Z]{2,}$/,n=this.driverForm.get("driverEmail")?.value;return!this.driverForm.invalid&&n&&!e.test(n)?(this._tostr.error("Invalid email address","Error"),!1):!0}validatePhone(){let e=/^[1-9]\d{9}$/,n=this.driverForm.get("driverPhone")?.value;return!this.driverForm.invalid&&n&&!e.test(n)?(this._tostr.error("Invalid phone number","Error"),!1):!0}};s.\u0275fac=function(n){return new(n||s)},s.\u0275cmp=q({type:s,selectors:[["app-driver-list"]],viewQuery:function(n,r){if(n&1&&Q(pe,5),n&2){let c;W(c=G())&&(r.searchTag=c.first)}},standalone:!0,features:[z],decls:160,vars:16,consts:[["inputValue",""],["selectedValue",""],[30],[1,"container","mt-3"],["enctype","multipart/form-data",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","driverName",1,"form-label"],[1,"text-danger"],["type","text","id","driverName","formControlName","driverName",1,"form-control"],["for","driverEmail",1,"form-label"],["type","email","id","driverEmail","formControlName","driverEmail",1,"form-control"],["for","driverProfile",1,"form-label"],["type","file","accept","image/*","id","driverProfile","name","driverProfile","formControlName","driverProfile",1,"form-control",3,"change"],["for","driverPhone",1,"form-label"],[1,"input-group"],["id","countryCode","formControlName","countryCallingCode",1,"select-small","border",3,"change"],[1,"bg-dark","text-white",3,"value"],["type","text","id","driverPhone","formControlName","driverPhone",1,"form-control","ms-3"],[1,"mt-3"],["for","city",1,"form-label"],["name","driverCity","id","city","formControlName","driverCity",1,"form-select",3,"change"],["type","submit",1,"btn","form-control","btn-success"],[1,"d-flex"],[1,"btn","btn-dark","text-white","btn-sm","my-2",3,"click"],[1,"input-group","mb-2"],["type","text",1,"form-control",3,"keyup.enter"],[1,"input-group-append"],[1,"input-group-text","bg-dark","text-white"],[1,"mt-4"],[1,"container","my-2"],[1,"h4"],["id","countryCode",1,"select-sort","form-select",3,"change"],["value","none",1,"my-2","border-bottom"],["value","driverName",1,"my-2","border-bottom"],["value","driverPhone",1,"my-2","border-bottom"],["value","driverEmail",1,"my-2","border-bottom"],[1,"table-responsive"],[1,"table"],[1,"text-center","border","bg-dark","text-white"],[1,"d-flex","justify-content-end","align-items-end","me-3"],[1,"btn","btn-dark","text-white","me-3","shadow",3,"click","disabled"],[1,"text-center","span","me-3"],[1,"btn","btn-dark","text-white","shadow",3,"click","disabled"],["id","mymodal",1,"modaldiv","modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header","text-center","bg-dark","text-white"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close","bg-white"],[1,"bg-dark","text-white","ps-3",2,"margin-top","-3px","margin-bottom","10px"],[1,"badge","bg-primary","mb-1"],[1,"text-warning"],[1,"container","vehicleTypeTable"],[1,"border","my-4","shadow"],[1,"ps-3",2,"width","20px"],["type","radio","id","default-card","name","default-card",3,"change","checked"],[1,"text-start"],["for","default-card"],[1,"badge","text-danger","default"],[1,"modal-footer","bg-dark"],["data-bs-dismiss","modal",1,"btn","btn-secondary","shadow","bg-white","text-dark"],["id","bankDetailsmodal",1,"modal","fade"],[1,"modal-header"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"container"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"btn","my-1","form-control","btn-info","me-5",3,"click"],[1,"btn","my-1","form-control","btn-warning",3,"click"],[1,"text-center","border","shadow-sm","mt-3"],["onerror","this.src='assets/noImageFound.jpg'",1,"my-1","border","profile","rounded","img-fluid",3,"src","alt"],[1,"overflow-auto"],["data-bs-toggle","modal","data-bs-target","#mymodal",1,"btn","btn-info","btn-sm","px-3","my-2","me-1","shadow",3,"click"],[1,"btn","btn-sm","px-3","my-2","me-1","shadow",3,"click"],["data-bs-toggle","modal","data-bs-target","#bankDetailsmodal",1,"btn","btn-success",3,"click"],[1,"btn","btn-warning","btn-sm","px-3","my-2","me-1","shadow",3,"click"],[1,"btn","btn-danger","btn-sm","px-3","my-2","me-1","shadow",3,"click"],[1,"badge","text-success","default"],[1,"placeholder"],[1,"row"],[1,"error"],[1,"mt-1","text-center","text-success"],["id","loginForm","enctype","multipart/form-data",3,"submit","formGroup"],["for","AccountHolderName",1,"form-label"],["type","text","id","AccountHolderName","name","AccountHolderName","placeholder","enter your AccountHolderName","formControlName","AccountHolderName",1,"form-control"],["for","AccountNumber",1,"form-label"],["type","text","id","AccountNumber","name","AccountNumber","placeholder","enter AccountNumber","formControlName","AccountNumber",1,"form-control"],["for","RoutingNumber",1,"form-label"],["type","text","id","RoutingNumber","name","RoutingNumber","placeholder","enter RoutingNumber","formControlName","RoutingNumber",1,"form-control"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-info","form-control"]],template:function(n,r){if(n&1){let c=F();l(0,"div",3)(1,"form",4),g("ngSubmit",function(){return p(c),_(r.onSubmit())}),l(2,"div",5)(3,"label",6)(4,"b"),o(5,"Driver Name"),l(6,"sup",7),o(7,"*"),i(),o(8,":"),i()(),f(9,"input",8),u(10,Ce,3,3),i(),l(11,"div",5)(12,"label",9)(13,"b"),o(14,"Driver Email"),l(15,"sup",7),o(16,"*"),i(),o(17,":"),i()(),f(18,"input",10),u(19,ye,3,3),i(),l(20,"div",5)(21,"label",11)(22,"b"),o(23,"Driver Profile"),l(24,"sup",7),o(25,"*"),i(),o(26,":"),i()(),l(27,"input",12),g("change",function(y){return p(c),_(r.onFileSelected(y))}),i(),u(28,Ee,1,1),i(),l(29,"div",5)(30,"label",13)(31,"b"),o(32,"Driver Phone with Country Code"),l(33,"sup",7),o(34,"*"),i(),o(35,":"),i()(),l(36,"div",14)(37,"select",15),g("change",function(){return p(c),_(r.getCitiesOrNot?r.getTheCities():null)}),k(38,Ne,2,3,"option",16,T),i(),u(40,Te,1,1),f(41,"input",17),i(),u(42,Pe,3,3),l(43,"div",18)(44,"label",19)(45,"b"),o(46,"Driver city"),l(47,"sup",7),o(48,"*"),i(),o(49,":"),i(),o(50," note:(Please select the country Code first)"),i(),l(51,"select",20),g("change",function(){return p(c),_(r.selectedCity())}),k(52,Ve,2,2,"option",16,T),i(),u(54,Ie,1,1),i()(),u(55,Re,2,0,"button",21),i(),u(56,qe,5,0,"div",22),l(57,"button",23),g("click",function(){p(c);let y=L(61);return _(r.searchDriver(y.value))}),o(58,"Search"),i(),l(59,"div",24)(60,"input",25,0),g("keyup.enter",function(){p(c);let y=L(61);return _(r.searchDriver(y.value))}),i(),l(62,"div",26)(63,"div",27),o(64,"Hit Enter"),i()()()(),l(65,"div",28)(66,"div",29)(67,"b",30),o(68,"Sort By:"),i(),l(69,"select",31,1),g("change",function(){p(c);let y=L(70);return _(r.SelectedSortValue(y.value))}),l(71,"option",32)(72,"b"),o(73,"none"),i()(),l(74,"option",33)(75,"b"),o(76,"Driver Name"),i()(),l(77,"option",34)(78,"b"),o(79,"Driver Phone No."),i()(),l(80,"option",35)(81,"b"),o(82,"Driver Email"),i()()()(),l(83,"div",36)(84,"table",37)(85,"tr",38)(86,"th"),o(87,"Driver Name"),i(),l(88,"th"),o(89,"Driver Profile"),i(),l(90,"th"),o(91,"Driver Phone"),i(),l(92,"th"),o(93,"Driver Email"),i(),l(94,"th"),o(95,"City"),i(),l(96,"th"),o(97,"Service Details"),i(),l(98,"th"),o(99,"Approve/Decline"),i(),l(100,"th"),o(101,"Bank Details"),i(),l(102,"th"),o(103,"Edit"),i(),l(104,"th"),o(105,"Delete"),i()(),u(106,$e,2,0),i()(),l(107,"div",39)(108,"button",40),g("click",function(){return p(c),_(r.previousBtn())}),o(109,"Prev"),i(),l(110,"span",41),o(111),i(),l(112,"button",42),g("click",function(){return p(c),_(r.nextBtn())}),o(113,"Next"),i()()(),l(114,"div",43)(115,"div",44)(116,"div",45)(117,"div",46)(118,"h4",47),o(119,"Assign Service"),i(),f(120,"br")(121,"button",48),i(),l(122,"h6",49)(123,"span",50),o(124,"note:"),i(),o(125," Please select the "),l(126,"b",51),o(127,"NONE"),i(),o(128," to remove the service "),i(),l(129,"div",52)(130,"table",37),u(131,je,2,0)(132,Qe,2,0)(133,We,2,0)(134,Ge,2,0),H(135,131,null,132,133,134,null,2,B),$(),l(137,"tr",53)(138,"th",54)(139,"input",55),g("change",function(){return p(c),_(r.onServiceNullSelected(null))}),i()(),l(140,"th",56)(141,"label",57),o(142,"NONE"),i(),u(143,Ke,2,0,"span",58),i()()()(),l(144,"div",59)(145,"button",60),o(146,"Close"),i()()()()(),l(147,"div",61)(148,"div",44)(149,"div",45)(150,"div",62)(151,"h4",47),o(152,"Add Bank Details"),i(),f(153,"button",63),i(),l(154,"div",64),u(155,ze,3,0,"div")(156,st,19,4),i(),l(157,"div",65)(158,"button",66),o(159,"Close"),i()()()()()}n&2&&(d(),b("formGroup",r.driverForm),d(9),m(10,r.driverName!==null&&(r.driverName.touched||r.driverName.dirty)?10:-1),d(9),m(19,r.driverEmail!==null&&(r.driverEmail.touched||r.driverEmail.dirty)?19:-1),d(9),m(28,r.driverProfile!==null&&(r.driverProfile.touched||r.driverProfile.dirty)?28:-1),d(10),w(r.CountryCodes),d(2),m(40,r.countryCallingCode!==null&&(r.countryCallingCode.touched||r.countryCallingCode.dirty)?40:-1),d(2),m(42,r.driverPhone!==null&&(r.driverPhone.touched||r.driverPhone.dirty)?42:-1),d(10),w(r.cityList),d(2),m(54,r.driverCity!==null&&(r.driverCity.touched||r.driverCity.dirty)?54:-1),d(),m(55,r.update?-1:55),d(),m(56,r.update?56:-1),d(50),m(106,r.driverFatchedlength>-1?106:-1),d(2),b("disabled",r.disablePrevBnt()),d(3),D(r.pageNumber),d(),b("disabled",r.disableNextBnt()),d(27),b("checked",!r.servicePresent),d(4),m(143,r.servicePresent?-1:143),d(12),m(155,r.selectedDriver&&r.selectedDriver.bankDetailsAdded?155:156))},dependencies:[se,te,oe,le,Y,ne,J,ee,ie,re,Z],styles:[".select-small[_ngcontent-%COMP%]{width:180px}.profile[_ngcontent-%COMP%]{height:80px;width:80px;border-radius:5px}.select-sort[_ngcontent-%COMP%]{display:inline;margin-left:20px;width:150px;border:3px solid rgb(213,213,214)}.modaldiv[_ngcontent-%COMP%]{background-color:transparent!important}.default[_ngcontent-%COMP%]{border:1px solid green;padding:3px}.delete[_ngcontent-%COMP%]{padding:4px}.vehicleTypeTable[_ngcontent-%COMP%]{height:25rem;overflow:auto}"]});let t=s;return t})();export{Ft as DriverListComponent};
