import{a as he}from"./chunk-KCJDKNAC.js";import{a as me}from"./chunk-CUPHGYWV.js";import{a as ue}from"./chunk-GSD4VRYZ.js";import{b as X,d as g,g as j,h as ee,j as te,l as ie,m as oe,n as ne,o as re,p as le,q as ae,s as se,u as ce}from"./chunk-HEVKUVIP.js";import{b as J,h as de,j as F}from"./chunk-362XMKWF.js";import{$b as $,Ab as T,Db as y,E as k,Fb as p,Ib as G,Kb as z,Mb as M,Nb as V,Ob as N,Qb as l,Rb as R,Sb as E,Ta as c,Tb as K,V as U,Y as q,Yb as Q,ac as L,ca as v,ha as W,hb as h,mb as I,o as x,pa as b,qa as S,qb as d,rb as D,sb as Z,tb as P,ub as w,vb as r,wb as n,wc as H,xb as u,xc as Y}from"./chunk-5BOCFAQI.js";var pe=(()=>{let a=class a{constructor(){this._http=v(J),this.url=`${F.BACKEND_URL}pricing/fetchCountries`}getCountryCodes(){return this._http.post(this.url,{})}getCities(e){return this._http.post(`${F.BACKEND_URL}pricing/getCity`,{countryId:e})}getCityPricing(e){return this._http.post(`${F.BACKEND_URL}pricing/getCityPricig`,{cityId:e})}storeRide(e){return this._http.post(`${F.BACKEND_URL}createRide/storeRide`,e)}checkForStartingPoint(e){return this._http.post(`${F.BACKEND_URL}createRide/checkForStartingPoint`,e)}};a.\u0275fac=function(o){return new(o||a)},a.\u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"});let i=a;return i})();function _e(){return i=>{let a=new Date(i.value);a&&console.log("SelectedDate",a);let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),o=new Date(t.getFullYear(),t.getMonth()+1,t.getDate());return console.log("inside the datevalidator",e),o.setMonth(e.getMonth()+1),a<e?{dateIsGone:!0}:a>o?{dateIsExceded:!0}:null}}function Ce(){return i=>{let a=i.value,t=i.parent?.get("bookingDate")?.value;if(console.log(t),t===null)return{selectDateFirst:!0};let e,o=new Date,s=new Date(t);if(o.getDate()===s.getDate()&&(a&&(e=a.split(":")),e)){if(o.getHours()>parseInt(e[0],10))return{timeIsBeforeNow:!0};if(o.getHours()==parseInt(e[0],10)&&o.getMinutes()+1>e[1])return{timeIsBeforeNow:!0}}return null}}var fe=["Stops"],xe=["StartPoint"],ve=["EndPoint"];function be(i,a){if(i&1&&(r(0,"option",12),l(1),n()),i&2){let t=a.$implicit;z("value","",t.country._id,"+",t.country.countryCode2,""),c(),K(" ",t.country.countryCallingCode," (",t.country.country,")")}}function Se(i,a){i&1&&(r(0,"span",9),l(1,"userPhone is required."),n())}function ye(i,a){i&1&&(r(0,"span",9),l(1,"userPhone should be "),r(2,"b"),l(3,"10"),n(),l(4," character long."),n())}function ke(i,a){i&1&&(r(0,"span",9),l(1,"character execeded."),n())}function Te(i,a){if(i&1&&h(0,Se,2,0,"span",9)(1,ye,5,0,"span",9)(2,ke,2,0,"span",9),i&2){let t=p(2);d(0,t.userPhone.errors!=null&&t.userPhone.errors.required?0:-1),c(),d(1,t.userPhone.errors!=null&&t.userPhone.errors.minlength?1:-1),c(),d(2,t.userPhone.errors!=null&&t.userPhone.errors.maxlength?2:-1)}}function Fe(i,a){if(i&1){let t=T();r(0,"button",18),y("click",function(){b(t);let o=p(2);return S(o.Clear())}),l(1,"Clear"),n()}}function Re(i,a){if(i&1&&(r(0,"div",16)(1,"table",19)(2,"tr")(3,"th"),l(4," User Name: "),n(),r(5,"td"),l(6),n()(),r(7,"tr")(8,"th"),l(9," User Email: "),n(),r(10,"td"),l(11),n()(),r(12,"tr")(13,"th"),l(14," User Phone: "),n(),r(15,"td"),l(16),n()()()()),i&2){let t=p(2);c(6),R(t.gotUser==null?null:t.gotUser.userName),c(5),R(t.gotUser==null?null:t.gotUser.userEmail),c(5),R(t.gotUser==null?null:t.gotUser.userPhone)}}function Pe(i,a){if(i&1){let t=T();r(0,"div",17)(1,"button",20),y("click",function(){b(t);let o=p(2);return S(o.getTheLocations())}),l(2,"Next"),n()()}}function we(i,a){if(i&1){let t=T();r(0,"form",6)(1,"div",7)(2,"label",8)(3,"b"),l(4,"Enter your Phone no. "),r(5,"sup",9),l(6,"*"),n(),l(7,":"),n()(),r(8,"div",10)(9,"select",11),P(10,be,2,5,"option",12,Z),n(),u(12,"input",13),n(),h(13,Te,3,3),n(),r(14,"button",14),y("click",function(){b(t);let o=p();return S(o.searchUser())}),l(15,"Search"),n(),h(16,Fe,2,0,"button",15)(17,Re,17,3,"div",16),n(),h(18,Pe,3,0,"div",17)}if(i&2){let t=p();I("formGroup",t.userForm),c(10),w(t.CountryCodes),c(3),d(13,t.userPhone!==null&&(t.userPhone.touched||t.userPhone.dirty)?13:-1),c(3),d(16,t.showDetails?16:-1),c(),d(17,t.showDetails?17:-1),c(),d(18,t.showDetails?18:-1)}}function Ee(i,a){i&1&&(r(0,"span",9),l(1,"Please Select the starting Location"),n(),u(2,"br"))}function Ie(i,a){if(i&1&&h(0,Ee,3,0),i&2){let t,e=p(2);d(0,!((t=e.locationForm.get("form"))==null||t.errors==null)&&t.errors.required?0:-1)}}function De(i,a){i&1&&(r(0,"span",9),l(1,"Please Select the End Location"),n(),u(2,"br"))}function Me(i,a){if(i&1&&h(0,De,3,0),i&2){let t,e=p(2);d(0,!((t=e.locationForm.get("to"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Ve(i,a){if(i&1){let t=T();r(0,"div",29)(1,"div",32)(2,"span"),l(3),n()(),r(4,"button",33),y("click",function(){let o=b(t).$implicit,s=p(2);return S(s.removeStop(o))}),u(5,"i",34),l(6,"Remove"),n()()}if(i&2){let t=a.$implicit;c(3),R(t)}}function Ne(i,a){if(i&1){let t=T();r(0,"form",21)(1,"div")(2,"label",22),l(3,"Form:"),n(),u(4,"input",23,0),h(6,Ie,1,1),n(),r(7,"div")(8,"label",24),l(9,"To:"),n(),u(10,"input",25,1),h(12,Me,1,1),n(),r(13,"label",26),l(14,"stops:"),n(),r(15,"div",10),u(16,"input",27,2),r(18,"div",28),y("click",function(){b(t);let o=p();return S(o.addNewStop())}),l(19,"Add Stops"),n()()(),P(20,Ve,7,1,"div",29,D),r(22,"div",30)(23,"button",31),y("click",function(){b(t);let o=p();return S(o.calculateRide())}),l(24,"Calculte"),n()()}if(i&2){let t,e,o=p();I("formGroup",o.locationForm),c(6),d(6,(t=o.locationForm.get("form"))!=null&&t.errors&&((t=o.locationForm.get("form"))!=null&&t.touched)?6:-1),c(6),d(12,(e=o.locationForm.get("to"))!=null&&e.errors&&((e=o.locationForm.get("to"))!=null&&e.touched)?12:-1),c(8),w(o.STOPS)}}function Oe(i,a){if(i&1&&(r(0,"div",37)(1,"div",51),l(2," Estimated Distance: "),n(),r(3,"div",52)(4,"b",53),l(5),$(6,"number"),n()(),r(7,"div",37)(8,"div",51),l(9," Estimated time: "),n(),r(10,"div",52)(11,"b",53),l(12),n(),l(13," hours "),r(14,"b",53),l(15),n(),l(16," minutes "),n()()()),i&2){let t=p(2);c(5),E(" \xA0 ",L(6,3,t.totalDistance,"1.2-2")," km"),c(7),E("\xA0 ",t.totalTime.hours,""),c(3),R(t.totalTime.minutes)}}function Ae(i,a){if(i&1&&(r(0,"div",37)(1,"div",51),l(2,"Total Fare with - "),r(3,"b"),l(4),n(),l(5," : "),n(),r(6,"div",52)(7,"b",53),l(8),$(9,"number"),n()()()),i&2){let t=a.$implicit;c(4),R(t.type),c(4),E("\xA0 ",L(9,2,t.totalPrice,"1.2-2"),"")}}function Be(i,a){if(i&1&&P(0,Ae,10,5,"div",37,D),i&2){let t=p(2);w(t.PriceListWithVehicleTypes)}}function Ue(i,a){if(i&1&&(r(0,"option",43),l(1),n()),i&2){let t=a.$implicit;G("value",t.typeId._id),c(),E(" ",t.typeId.vehicleType," ")}}function $e(i,a){i&1&&(u(0,"br"),r(1,"span",9),l(2,"Please Select the Service Type"),n(),u(3,"br"))}function Le(i,a){if(i&1&&h(0,$e,4,0),i&2){let t,e=p(2);d(0,!((t=e.bookRideForm.get("serviceType"))==null||t.errors==null)&&t.errors.required?0:-1)}}function qe(i,a){i&1&&(r(0,"label",45),u(1,"input",54),l(2," Card "),n())}function We(i,a){i&1&&(u(0,"br"),r(1,"span",9),l(2,"Please select the payment Method"),n(),u(3,"br"))}function Ze(i,a){if(i&1&&h(0,We,4,0),i&2){let t,e=p(2);d(0,!((t=e.bookRideForm.get("paymentMethod"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Ge(i,a){i&1&&(u(0,"br"),r(1,"span",9),l(2,"Please make choise"),n(),u(3,"br"))}function ze(i,a){if(i&1&&h(0,Ge,4,0),i&2){let t,e=p(2);d(0,!((t=e.bookRideForm.get("bookStatus"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Ke(i,a){i&1&&(r(0,"span",9),l(1,"Please choose the "),r(2,"b"),l(3,"Date"),n(),l(4," of Journey"),n(),u(5,"br"))}function Qe(i,a){i&1&&(r(0,"span",9),l(1,"Please choose the date From "),r(2,"b"),l(3,"now"),n()(),u(4,"br"))}function He(i,a){i&1&&(r(0,"span",9),l(1,"Please choose the date between "),r(2,"b"),l(3,"now"),n(),l(4," and one "),r(5,"b"),l(6,"month form now"),n()())}function Ye(i,a){if(i&1&&h(0,Ke,6,0)(1,Qe,5,0)(2,He,7,0,"span",9),i&2){let t,e,o,s=p(3);d(0,!((t=s.bookRideForm.get("bookingDate"))==null||t.errors==null)&&t.errors.required?0:-1),c(),d(1,!((e=s.bookRideForm.get("bookingDate"))==null||e.errors==null)&&e.errors.dateIsGone?1:-1),c(),d(2,!((o=s.bookRideForm.get("bookingDate"))==null||o.errors==null)&&o.errors.dateIsExceded?2:-1)}}function Je(i,a){i&1&&(r(0,"span",9),l(1,"Please choose the time of Journey"),n(),u(2,"br"))}function Xe(i,a){i&1&&(r(0,"span",9),l(1,"Please choose the "),r(2,"b"),l(3,"time"),n(),l(4," From "),r(5,"b"),l(6,"now"),n()(),u(7,"br"))}function je(i,a){i&1&&(r(0,"span",9),l(1,"Please select "),r(2,"b"),l(3,"Date"),n(),l(4," first "),n(),u(5,"br"))}function et(i,a){if(i&1&&h(0,Je,3,0)(1,Xe,8,0)(2,je,6,0),i&2){let t,e,o,s=p(3);d(0,!((t=s.bookRideForm.get("booktime"))==null||t.errors==null)&&t.errors.required?0:-1),c(),d(1,!((e=s.bookRideForm.get("booktime"))==null||e.errors==null)&&e.errors.timeIsBeforeNow?1:-1),c(),d(2,!((o=s.bookRideForm.get("booktime"))==null||o.errors==null)&&o.errors.selectDateFirst?2:-1)}}function tt(i,a){if(i&1){let t=T();r(0,"div",55)(1,"input",56),y("input",function(){b(t);let o=p(2);return S(o.dateSelected())}),n(),u(2,"input",57),n(),r(3,"div",55)(4,"div",58),h(5,Ye,3,3),n(),r(6,"div",58),h(7,et,3,3),n()()}if(i&2){let t,e,o=p(2);c(5),d(5,(t=o.bookRideForm.get("bookingDate"))!=null&&t.errors&&((t=o.bookRideForm.get("bookingDate"))!=null&&t.touched)?5:-1),c(2),d(7,(e=o.bookRideForm.get("booktime"))!=null&&e.errors&&((e=o.bookRideForm.get("booktime"))!=null&&e.touched)?7:-1)}}function it(i,a){if(i&1){let t=T();r(0,"div",35)(1,"div",36),h(2,Oe,17,6,"div",37),r(3,"div",38),h(4,Be,2,0),n()()(),r(5,"div",35)(6,"div")(7,"form",39)(8,"div",40)(9,"label",41),l(10,"Select Service Type:"),n(),u(11,"br"),r(12,"select",42),P(13,Ue,2,2,"option",43,D),n(),h(15,Le,1,1),n(),r(16,"div",44)(17,"div",38),l(18,"Select Payment Method:"),n(),r(19,"label",45),u(20,"input",46),l(21," Cash "),n(),h(22,qe,3,0,"label",45)(23,Ze,1,1),n(),r(24,"div",47)(25,"label",45),u(26,"input",48),l(27," Book now "),n(),r(28,"label",45),u(29,"input",49),l(30," Schedule "),n(),h(31,ze,1,1),n(),h(32,tt,8,2),r(33,"div",50)(34,"button",20),y("click",function(){b(t);let o=p();return S(o.BookRide())}),l(35,"Book Ride"),n()()()()()}if(i&2){let t,e,o,s,m=p();c(2),d(2,m.totalTime?2:-1),c(2),d(4,m.PriceListWithVehicleTypes?4:-1),c(3),I("formGroup",m.bookRideForm),c(6),w(m.cityPricingOfTypes),c(2),d(15,(t=m.bookRideForm.get("serviceType"))!=null&&t.errors&&((t=m.bookRideForm.get("serviceType"))!=null&&t.touched)?15:-1),c(7),d(22,m.UserCards.length>0?22:-1),c(),d(23,(e=m.bookRideForm.get("paymentMethod"))!=null&&e.errors&&((e=m.bookRideForm.get("paymentMethod"))!=null&&e.touched)?23:-1),c(8),d(31,(o=m.bookRideForm.get("bookStatus"))!=null&&o.errors&&((o=m.bookRideForm.get("bookStatus"))!=null&&o.touched)?31:-1),c(),d(32,((s=m.bookRideForm.get("bookStatus"))==null?null:s.value)==="schedule"?32:-1)}}var Ft=(()=>{let a=class a{constructor(){this._createRideService=v(pe),this._toastr=v(de),this._fb=v(se),this._userService=v(he),this._setting=v(ue),this._socketIO=v(me),this.API_KEY=F.API_KEY,this.locationMarker=null,this.FormStop=null,this.ToStop=null,this.IntermediateStop=null,this.CountryCodes=[],this.showDetails=!1,this.showOverView=!1,this.addPlaces=!1,this.selectedCountryC2="",this.CountryId="",this.cities=[],this.CityZones=[],this.isInsideTheZone=!1,this.STOPS=[],this.cityPricingOfTypes=[],this.PriceListWithVehicleTypes=[],this.totalDistance=0,this.totalTime={hours:0,minutes:0},this.UserCards=[]}ngOnInit(){this.getCountryCodes(),this.getSettings(),this.userForm=this._fb.group({userPhone:["1111111111",[g.required,g.minLength(10),g.maxLength(10)]],countryCC:["",g.required],userName:[{value:"",disabled:!0}],userEmail:[{value:"",disabled:!0}]}),this.locationForm=this._fb.group({form:["",g.required],to:["",g.required],stops:[""]}),this.bookRideForm=this._fb.group({serviceType:["",g.required],paymentMethod:["cash",g.required],bookStatus:["now",g.required],bookingDate:[,[g.required,_e()]],booktime:[,[g.required,Ce()]]})}getCountryCodes(){this._createRideService.getCountryCodes().pipe(U(e=>{e.length>-1&&(this.CountryCodes=e,console.log(e),console.log(this.CountryCodes))}),k(e=>(this._toastr.error("Enable to fatch country code","Error"),console.log("some error occured"),x(e)))).subscribe()}getSettings(){this._setting.getSettings().pipe(k(e=>(this._toastr.error("Error Occured while fatching the settings","Error"),x(e)))).subscribe({next:e=>{this.setting=e,console.log(this.setting)}})}searchUser(){if(this.userForm.get("userPhone")?.value.trim()===""||this.userForm.get("countryCC")?.value.trim()===""){this._toastr.warning("Please enter Phone no and Country code","warning");return}if(!this.validatePhone())return;console.log(this.userForm.get("countryCC")?.value.trim());let e=this.userForm.get("countryCC")?.value.split("+");this.CountryId=e[0],this.selectedCountryC2=e[1];let o={countryCC:this.CountryId,userPhone:this.userForm.get("userPhone")?.value};this._userService.getSinglUser(o).pipe(k(s=>s.error.status==="No user found"?(this._toastr.warning("No user found","warning"),x(s)):(this._toastr.info("No user found","warning"),x(s)))).subscribe({next:s=>{console.log(s),s.status=="success"&&(this.userForm.get("userPhone")?.disable(),this.userForm.get("countryCC")?.disable(),this.gotUser=s.user,this.showDetails=!0,this.UserCards=s.cardArray,console.log("this.usercards",this.UserCards),this._toastr.info("user found","info"))},complete:()=>{}})}addNewStop(){console.log(this.StopsField.nativeElement.value);let e=this.StopsField.nativeElement.value;if(this.locationForm.invalid){this._toastr.warning("First add form and to location ","Warning");return}else if(this.autocompleteInput3.value.trim()==""||this.IntermediateStop!==this.StopsField.nativeElement.value){this._toastr.warning("Please select form autosuggetion ");return}this.bookRideForm.reset();for(let o=0;o<this.STOPS.length;o++)if(this.STOPS[o]===e){this._toastr.error("Place already added","error");return}if(this.STOPS.length+1>this.setting.Stops){this._toastr.warning("Max no. of stops exceeded ","Warning");return}this.STOPS.push(e),this.IntermediateStop=null,this.autocompleteInput3.value="",this.calculateRide(),console.log(this.STOPS),console.log("this.STOPS.length ",this.STOPS.length),console.log("this.setting.Stops ",this.setting.Stops)}calculateTotalFare(e){let o=0;this.totalDistance>e.distanceForBasePrice&&(o=this.totalDistance-e.distanceForBasePrice);let s=0;return o&&(s=o*e.pricePerUnitDistance+(this.totalTime.hours/60+this.totalTime.minutes)*e.pricePerUnitTime_Min),s<e.basePrice?{totalPrice:e.basePrice,type:e.typeId.vehicleType,typeId:e.typeId._id}:{totalPrice:s+e.basePrice,type:e.typeId.vehicleType,typeId:e.typeId._id}}removeStop(e){console.log(e);let o=this.STOPS.findIndex(s=>s===e);this.STOPS.splice(o,1),this.DirectionsRenderer&&this.calculateRide()}TurnAutocomplete(){let e=document.getElementById("form-location");this.initAutocomplete(e,this.locationMarker,"form");let o=document.getElementById("to-location");this.initAutocomplete(o,this.locationMarker,"to"),this.autocompleteInput3=document.getElementById("stops"),this.initAutocomplete(this.autocompleteInput3,this.locationMarker,"stops")}initAutocomplete(e,o,s){let m=new google.maps.places.Autocomplete(e);m.setComponentRestrictions({country:this.selectedCountryC2}),m.addListener("place_changed",()=>{let _=m.getPlace();s==="form"?(console.log("inside the autocomplete (stops)"),this.checkForPlace(_)):s==="stops"?(this.IntermediateStop=this.StopsField.nativeElement.value,console.log("inside the autocomplete (stops)"),console.log(_.place_id)):s==="to"&&(this.ToStop=this.EndField.nativeElement.value,this.DirectionsRenderer&&this.calculateRide(),console.log("inside the autocomplete to")),this.locationMarker&&this.locationMarker?.setMap(null),this.locationMarker=new google.maps.Marker({map:this.map,position:_.geometry?.location,title:_.name}),this.focusMarker("from"),(!_||!_.geometry||!_.geometry.location)&&this._toastr.warning("Please enter a valid location.","warning")})}checkForPlace(e){if(this.isInsideTheZone=!1,console.log("checkForPlace called ------>"),e&&e.geometry&&e.geometry.location){let o=e.geometry.location.lat(),s=e.geometry.location.lng(),m=new google.maps.LatLng(o,s);this._createRideService.checkForStartingPoint(m).pipe(k(_=>(console.log("not in zone ",_),x(_))),U(_=>{"cityId"in _&&_.message==="Point is Inside of the zone"&&(this.CityId=_.cityId,this.getPricing(this.CityId),console.log("inside the zone",_),this.isInsideTheZone=!0,console.log("isisidethezone",this.isInsideTheZone),this._toastr.success("Service is available","success"),this.FormStop=this.StartField.nativeElement.value)})).subscribe({next:()=>{if(!this.isInsideTheZone){console.log("isisidethezone",this.isInsideTheZone),this._toastr.error("Service is not Available Here","error"),this.DirectionsRenderer&&this.DirectionsRenderer.setMap(null),console.log("checkForPlace finished------>");return}}}),console.log("isisidethezone",this.isInsideTheZone)}console.log("checkForPlace finished------>")}getTheLocations(){this.addPlaces=!0,this._createRideService.getCities(this.CountryId).pipe(k(e=>(e.status===400&&this._toastr.error("Cities Not found","Error"),x(e)))).subscribe({next:e=>{e.status==="Cties Found"?(console.log(e),this.cities=e.cities,console.log(this.cities),this.TurnAutocomplete()):this._toastr.warning("No Cities found","Warning")}})}calculateRide(){if(this.locationForm.get("form")?.value.trim()===""||this.locationForm.get("to")?.value.trim()===""){this.locationForm.markAllAsTouched(),this._toastr.warning("First add form and to location ","Warning");return}if(this.FormStop===this.ToStop&&!(this.STOPS.length>0)){this._toastr.warning("Please Add Way Point because Both locations can't be same"),this.showOverView=!1,this.DirectionsRenderer&&this.DirectionsRenderer.setMap(null);return}if(this.FormStop!==this.StartField.nativeElement.value||this.ToStop!==this.EndField.nativeElement.value){this._toastr.warning("Please select location form suggetions ","Warning");return}if(!this.isInsideTheZone){this._toastr.error("from location is outside the zone","error");return}console.log("calulateRide"),this.drawingFunction()}calulateAllServicePrices(){console.log("inside the calulateAllServicePrices "),console.log(this.cityPricingOfTypes),this.cityPricingOfTypes&&(this.PriceListWithVehicleTypes=this.cityPricingOfTypes.map(e=>{let o=this.calculateTotalFare(e);return console.log(`total fare for${e.typeId.vehicleType} : ${o}`,o),o})),console.log("Last line of calculateAllServicePrices ",this.PriceListWithVehicleTypes)}drawingFunction(){this.locationMarker&&this.locationMarker.setMap(null),this.DirectionsRenderer&&this.DirectionsRenderer.setMap(null),this.DirectionService=new google.maps.DirectionsService,this.DirectionsRenderer=new google.maps.DirectionsRenderer,this.DirectionsRenderer.setMap(this.map);let e={origin:this.StartField.nativeElement.value,destination:this.EndField.nativeElement.value,waypoints:this.STOPS.map(o=>({location:o})),travelMode:google.maps.TravelMode.DRIVING,optimizeWaypoints:!0};this.DirectionService.route(e,(o,s)=>{if(s=="OK"){console.log(o),this.totalDistance=o?.routes.reduce((C,O)=>C+O.legs.reduce((A,B)=>A+(B.distance?.value||0),0),0);let m=o?.routes.reduce((C,O)=>C+O.legs.reduce((A,B)=>A+(B.duration?.value||0),0),0),_,f;m&&(_=Math.floor(m/3600),f=Math.floor(m%3600/60),this.totalTime.hours=_,this.totalTime.minutes=f),this.totalDistance&&(this.totalDistance/=1e3),this.calulateAllServicePrices(),console.log("Total distance in km",this.totalDistance),console.log(`total Time:${_} hours and ${f} minutes`),this.DirectionsRenderer.setDirections(o),this.showOverView=!0}else{this._toastr.error("Service not available","Error");return}})}validationForBookNow(){return this.bookRideForm.get("serviceType")?.markAsTouched(),this.bookRideForm.get("paymentMethod")?.markAsTouched(),!!(this.bookRideForm.get("serviceType")?.valid&&this.bookRideForm.get("paymentMethod")?.valid)}BookRide(){console.log(this.bookRideForm.get("bookStatus")?.value),this.bookRideForm.invalid&&this.bookRideForm.markAllAsTouched();let e;if(this.bookRideForm.get("bookStatus")?.value.trim()===""){this.bookRideForm.markAllAsTouched();return}if(this.bookRideForm.get("bookStatus")?.value==="schedule"){if(this.bookRideForm.invalid){this.bookRideForm.markAllAsTouched(),this._toastr.error("Please fill the all required/valid fields","Error");return}this.storeRideInfo()}else{if(console.log("inside the now conditoion "),e=this.validationForBookNow(),console.log("flagForBookNow",e),e){if(!this.isInsideTheZone){console.log("inside the now conditoion  not insidethezone "),this._toastr.error("Please select the proper locations first","error");return}}else{console.log("inside the now conditoion flaforbooknow"),this._toastr.error("Please fill all required fields","error");return}console.log("storing theh data "),this.storeRideInfo()}}storeRideInfo(){let e=new Date,o=`${e.getDate()}`,s=`${e.getMonth()+1}`;console.log("todaysDate",e),e.getMonth()+1<10&&(s=`0${e.getMonth()+1}`),e.getDate()<10&&(o=`0${e.getDate()}`);let m=`${e.getHours()}:${e.getMinutes()+1}`,_=this.PriceListWithVehicleTypes.findIndex(C=>C.typeId===this.bookRideForm.get("serviceType")?.value),f={userId:this.gotUser?._id,typeId:this.bookRideForm.get("serviceType")?.value,cityId:this.CityId,date:`${e.getFullYear()}-${s}-${o}`,time:e.getTime(),timeInString:m,paymentMethod:this.bookRideForm.get("paymentMethod")?.value,totalDistance:parseFloat(this.totalDistance.toFixed(2)),totalTime:this.totalTime.hours*60+this.totalTime.minutes,totalFare:parseFloat(this.PriceListWithVehicleTypes[_].totalPrice.toFixed(2)),endLocation:this.ToStop,startLocation:this.FormStop,route:this.STOPS};if(console.log("totaltime.hours/",this.totalTime.hours/60),console.log("details",f),this.bookRideForm.get("bookStatus")?.value==="schedule"){let C=new Date(`${this.bookRideForm.get("bookingDate")?.value}T${this.bookRideForm.get("booktime")?.value}`);f.date=this.bookRideForm.get("bookingDate")?.value,f.time=C.getTime()}this._socketIO.emitNewEvent("newRideCame",{}),this._createRideService.storeRide(f).pipe(k(C=>(this._toastr.error("error"),x(C)))).subscribe({next:C=>{console.log(C),C.status===200?(this._toastr.success(C.message,"Success"),this.bookRideForm.reset(),this.locationForm.reset(),this.userForm.reset(),this.showOverView=!1,this.addPlaces=!1,this.showDetails=!1,this.userForm.get("userPhone")?.enable(),this.userForm.get("countryCC")?.enable(),this.DirectionsRenderer.setMap(null),this.STOPS=[],this.map.setCenter({lat:25.4484,lng:78.5685}),this.map.setZoom(6)):C.status===300&&this._toastr.error(C.message,"error")}}),console.log(f)}getPricing(e){this._createRideService.getCityPricing(e).pipe(k(o=>(console.log(o),x(o)))).subscribe({next:o=>{this.cityPricingOfTypes=o.pricings,console.log(o),console.log("this.cityPricingOfTypes----->",this.cityPricingOfTypes)}})}dateSelected(){this.bookRideForm.get("booktime")?.setValue("")}get userPhone(){return this.userForm.get("userPhone")}validatePhone(){let e=/^[1-9]\d{9}$/,o=this.userForm.get("userPhone")?.value;return!this.userForm.invalid&&o&&!e.test(o)?(this._toastr.error("Invalid phone number","Error"),!1):!0}focusMarker(e){this.locationMarker&&this.map&&(this.map.setCenter(this.locationMarker.getPosition()),this.map.setZoom(10))}Clear(){this.showDetails=!1,this.gotUser=null,this.userForm.reset(),this.userForm.get("userPhone")?.setValue(""),this.userForm.get("countryCC")?.setValue(""),this.userForm.get("userPhone")?.enable(),this.userForm.get("countryCC")?.enable()}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=W({type:a,selectors:[["app-create-ride"]],viewQuery:function(o,s){if(o&1&&(M(fe,5),M(xe,5),M(ve,5)),o&2){let m;V(m=N())&&(s.StopsField=m.first),V(m=N())&&(s.StartField=m.first),V(m=N())&&(s.EndField=m.first)}},standalone:!0,features:[Q],decls:6,vars:3,consts:[["StartPoint",""],["EndPoint",""],["Stops",""],[1,"row"],[1,"col","col-xxl-4","col-xl-4","col-lg-4","col-md-12","col-sm-12","col-xs-12","col-12","mb-4"],["id","map",1,"mapBox","shadow","col","col-xxl-8","col-xl-8","col-lg-8","col-md-12","col-sm-12","col-xs-12","col-12"],[1,"shadow","px-3","rounded","pb-3",3,"formGroup"],[1,"mb-3"],["for","userPhone",1,"form-label"],[1,"text-danger"],[1,"input-group"],["name","countryCallingCode","formControlName","countryCC",1,"select-small","border"],[1,"bg-dark","text-white",3,"value"],["type","text","id","userPhone","formControlName","userPhone",1,"form-control"],[1,"btn","btn-info","my-1","shadow",3,"click"],[1,"btn","btn-warning","my-1","mx-3","shadow"],[1,"d-flex","justify-content-center","shadow","my-2","mb-6","rounded"],[1,"d-flex","justify-content-end","align-item-center","my-2"],[1,"btn","btn-warning","my-1","mx-3","shadow",3,"click"],[1,"my-2","table-responsive"],[1,"btn","btn-success","shadow",3,"click"],["id","locationForm",1,"shadow","p-3","rounded",3,"formGroup"],["for","form-location"],["type","text","name","form","id","form-location","formControlName","form",1,"form-control"],["for","to-location"],["type","text","name","to","id","to-location","formControlName","to",1,"form-control"],["for","stops",1,"mt-4"],["type","text","name","stops","id","stops","formControlName","stops",1,"form-control","rounded"],[1,"btn","btn-dark","text-white","ms-2","rounded",3,"click"],[1,"input-group","my-4"],[1,"text-end","mt-4"],[1,"btn","btn-success","text-white",3,"click"],[1,"border","form-control","shadow","owerflow-auto"],[1,"btn","btn-danger","ms-2","rounded","text-white","shadow",3,"click"],[1,"fa","fa-trash"],[1,"container","mt-4","rounded","shadow","p-1"],[1,"rounded","shadow-start"],[1,"text-center","mb-1"],[1,"text-center"],[3,"formGroup"],[1,"border","my-1","p-1"],["for","serviceType"],["name","serviceType","id","serviceType","formControlName","serviceType",1,"selecttype","border"],[3,"value"],[1,"text-center","border","p-1"],[1,"mx-3"],["type","radio","name","paymentMethod","formControlName","paymentMethod","value","cash"],[1,"text-center","border","p-2"],["type","radio","name","bookStatus","formControlName","bookStatus","value","now"],["type","radio","name","bookStatus","formControlName","bookStatus","value","schedule"],[1,"mt-2","text-center"],[1,"w-50","d-inline-block","text-end","border-bottom"],[1,"w-50","d-inline-block","text-start","border-bottom"],[1,"text-primary"],["type","radio","name","paymentMethod","formControlName","paymentMethod","value","card"],[1,"d-flex"],["type","date","formControlName","bookingDate",1,"form-control","m-2",3,"input"],["type","time","formControlName","booktime",1,"form-control","m-2"],[1,"d-inline-block","w-50","ms-3"]],template:function(o,s){o&1&&(r(0,"div",3)(1,"div",4),h(2,we,19,5)(3,Ne,25,3),n(),u(4,"div",5),h(5,it,36,8),n()),o&2&&(c(2),d(2,s.addPlaces?-1:2),c(),d(3,s.addPlaces?3:-1),c(2),d(5,s.showOverView?5:-1))},dependencies:[ce,te,le,ae,X,re,ie,j,ee,oe,ne,Y,H],styles:[".left[_ngcontent-%COMP%]{margin-top:2vh;height:70vh;float:left}.right[_ngcontent-%COMP%]{margin-top:2vh;height:70vh;width:30vw;float:right}.select-small[_ngcontent-%COMP%]{width:80px}td[_ngcontent-%COMP%]{color:#00f}.mapBox[_ngcontent-%COMP%]{height:80vh;border-radius:15px}.selecttype[_ngcontent-%COMP%]{width:200px}.shadow[_ngcontent-%COMP%]{box-shadow:0 .5rem 1rem #00000026}"]});let i=a;return i})();export{Ft as CreateRideComponent};
